var VanillaTables=(()=>{var O=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var rt=Object.getOwnPropertyNames;var it=Object.prototype.hasOwnProperty;var ot=(h,t)=>{for(var e in t)O(h,e,{get:t[e],enumerable:!0})},nt=(h,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of rt(t))!it.call(h,r)&&r!==e&&O(h,r,{get:()=>t[r],enumerable:!(s=st(t,r))||s.enumerable});return h};var at=h=>nt(O({},"__esModule",{value:!0}),h);var wt={};ot(wt,{VanillaTable:()=>S,actionsDropdownPlugin:()=>Y,bootstrapThemePlugin:()=>J,bulmaThemePlugin:()=>X,createCursorAdapter:()=>et,createGraphQLAdapter:()=>tt,createRestAdapter:()=>Z,createVanillaTable:()=>gt,muiThemePlugin:()=>_,stripedRowsPlugin:()=>G,tailwindThemePlugin:()=>Q,themePlugin:()=>x});var b={search:"Search",filter:"Filter",rows:"Rows",actions:"Actions",loading:"Loading...",empty:"No results found",pageInfo:"Page {page} of {totalPages} ({totalRows} rows)",first:"First",prev:"Previous",next:"Next",last:"Last"};var N={pageSize:10,pageSizeOptions:[10,25,50,100],searchable:!0,columnFilters:!0,sortable:!0,multiSort:!0,maxSorts:3,pagination:!0,initialSort:null,debounceMs:120,fixedHeader:!1,fixedFooter:!1,fixedColumns:0,fixedTopRows:0,expandableRows:!1,editableRows:!1,editableColumns:{},rowIdKey:"id",serverSide:!1,fetchData:null,virtualScroll:{enabled:!1,rowHeight:40,overscan:6,height:420},parallel:{enabled:!0,threshold:2e4,workers:"auto",timeoutMs:4e3,retries:1},persistence:{enabled:!1,storageKey:null},urlSync:{enabled:!1,param:"vt"},columnResize:!0,columnReorder:!0,rowActions:[],events:{debug:!1},themeClasses:{},expandRow:null,i18n:b,labels:{search:b.search,filter:b.filter,rows:b.rows,actions:b.actions,loading:b.loading,pageInfo:({page:h,totalPages:t,totalRows:e})=>b.pageInfo.replace("{page}",String(h)).replace("{totalPages}",String(t)).replace("{totalRows}",String(e)),empty:b.empty,first:b.first,prev:b.prev,next:b.next,last:b.last},columns:[]};var C=class{constructor({root:t,options:e,theme:s}){this.root=t,this.options=e,this.theme=s}mount(){this.root.innerHTML=`
      <div class="${this.theme.classOf("shell","vt-shell")}">
        <div class="${this.theme.classOf("controls","vt-controls")}">
          <label class="${this.theme.classOf("sizeWrap","vt-size-wrap")}">
            <span>${this.options.labels.rows}</span>
            <select class="${this.theme.classOf("sizeSelect","vt-size")}"></select>
          </label>
          <label class="${this.theme.classOf("searchWrap","vt-search-wrap")}">
            <span>${this.options.labels.search}</span>
            <input class="${this.theme.classOf("searchInput","vt-search")}" type="search" placeholder="Type to filter..." />
          </label>
        </div>
        <div class="${this.theme.classOf("tableWrap","vt-table-wrap")}" style="${this.options.virtualScroll.enabled?`height:${this.options.virtualScroll.height}px;overflow:auto;`:""}">
          <table class="${this.theme.classOf("table","vt-table")}" role="grid" aria-rowcount="-1">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="${this.theme.classOf("footer","vt-footer")} ${this.options.fixedFooter?this.theme.classOf("fixedFooter","vt-fixed-footer"):""}">
          <span class="${this.theme.classOf("info","vt-info")}"></span>
          <div class="${this.theme.classOf("paginationGroup","vt-pagination-group")}">
            <button class="${this.theme.classOf("firstButton","vt-page-btn vt-first")}" type="button">${this.options.labels.first}</button>
            <button class="${this.theme.classOf("prevButton","vt-page-btn vt-prev")}" type="button">${this.options.labels.prev}</button>
            <button class="${this.theme.classOf("nextButton","vt-page-btn vt-next")}" type="button">${this.options.labels.next}</button>
            <button class="${this.theme.classOf("lastButton","vt-page-btn vt-last")}" type="button">${this.options.labels.last}</button>
          </div>
        </div>
      </div>
    `;let t={search:this.root.querySelector(".vt-search"),pageSize:this.root.querySelector(".vt-size"),tableWrap:this.root.querySelector(".vt-table-wrap"),table:this.root.querySelector(".vt-table"),thead:this.root.querySelector("thead"),tbody:this.root.querySelector("tbody"),info:this.root.querySelector(".vt-info"),first:this.root.querySelector(".vt-first"),prev:this.root.querySelector(".vt-prev"),next:this.root.querySelector(".vt-next"),last:this.root.querySelector(".vt-last")};return t.pageSize.innerHTML=this.options.pageSizeOptions.map(e=>`<option value="${e}">${e}</option>`).join(""),t.pageSize.value=String(this.options.pageSize),this.options.searchable||(t.search.closest(".vt-search-wrap").style.display="none"),this.options.pagination||(this.root.querySelector(".vt-footer").style.display="none"),t}};var k=class{constructor({options:t,theme:e}){this.options=t,this.theme=e}render(t,e,s,r,i,o){let n=[],a=document.createElement("tr");if(a.setAttribute("role","row"),this.options.expandableRows){let l=document.createElement("th");l.className=this.theme.classOf("headerCell","vt-header-cell"),a.appendChild(l)}if(e.forEach((l,d)=>{let p=document.createElement("th");p.className=this.theme.classOf("headerCell","vt-header-cell"),p.dataset.key=l.key,p.draggable=!!this.options.columnReorder,p.tabIndex=0,p.setAttribute("role","columnheader"),i(p,d+(this.options.expandableRows?1:0)),o[l.key]&&(p.style.width=`${o[l.key]}px`);let u=document.createElement("button");u.type="button",u.className=this.theme.classOf("sortTrigger","vt-sort-trigger"),u.dataset.key=l.key;let c=s.findIndex(g=>g.key===l.key),m=c>=0?s[c]:null,f=m?m.direction==="asc"?` \u25B2${s.length>1?` ${c+1}`:""}`:` \u25BC${s.length>1?` ${c+1}`:""}`:"";if(u.textContent=`${l.label}${f}`,u.disabled=l.sortable===!1||!this.options.sortable,p.setAttribute("aria-sort",m?m.direction==="asc"?"ascending":"descending":"none"),p.appendChild(u),this.options.columnResize){let g=document.createElement("span");g.className=this.theme.classOf("resizeHandle","vt-resize-handle"),g.dataset.key=l.key,g.tabIndex=0,g.setAttribute("role","separator"),g.setAttribute("aria-orientation","vertical"),p.appendChild(g)}a.appendChild(p)}),this.options.rowActions.length){let l=document.createElement("th");l.textContent=this.options.labels.actions,l.className=this.theme.classOf("actionHeader","vt-actions-header"),a.appendChild(l)}if(n.push(a),this.options.columnFilters){let l=document.createElement("tr");if(l.className=this.theme.classOf("filterRow","vt-filter-row"),l.setAttribute("role","row"),this.options.expandableRows){let d=document.createElement("th");d.className=this.theme.classOf("filterHeaderCell","vt-filter-header-cell"),l.appendChild(d)}e.forEach((d,p)=>{let u=document.createElement("th");if(u.className=this.theme.classOf("filterHeaderCell","vt-filter-header-cell"),i(u,p+(this.options.expandableRows?1:0)),d.filterable===!1){l.appendChild(u);return}let c=document.createElement("input");c.className=this.theme.classOf("columnFilter","vt-column-filter"),c.placeholder=`${this.options.labels.filter} ${d.label}`,c.value=r[d.key]||"",c.dataset.key=d.key,u.appendChild(c),l.appendChild(u)}),this.options.rowActions.length&&l.appendChild(document.createElement("th")),n.push(l)}t.innerHTML="",n.forEach(l=>{t.appendChild(l)}),this.options.fixedHeader&&lt(t,this.theme.classOf("fixedHeader","vt-fixed-header"))}};function lt(h,t){t.split(/\s+/).filter(Boolean).forEach(e=>{h.classList.add(e)})}var R=class{constructor({options:t,hooks:e,theme:s}){this.options=t,this.hooks=e,this.theme=s}render(t,e,s,r,i){if(t.innerHTML="",!s.length){let n=document.createElement("tr");n.setAttribute("role","row");let a=document.createElement("td");a.setAttribute("role","gridcell"),a.colSpan=e.length+(this.options.expandableRows?1:0)+(this.options.rowActions.length?1:0),a.className=this.theme.classOf("emptyCell","vt-empty"),a.textContent=this.options.labels.empty,n.appendChild(a),t.appendChild(n);return}let o=r.virtualization.enabled?s.slice(r.virtualization.start,r.virtualization.end):s;if(r.virtualization.enabled&&r.virtualization.start>0){let n=document.createElement("tr");n.className="vt-virtual-top";let a=document.createElement("td");a.colSpan=e.length+(this.options.expandableRows?1:0)+(this.options.rowActions.length?1:0),a.style.height=`${r.virtualization.start*r.virtualization.rowHeight}px`,a.style.padding="0",a.style.border="none",n.appendChild(a),t.appendChild(n)}if(o.forEach((n,a)=>{let l=r.virtualization.enabled?r.virtualization.start+a:a,d=r.getRowId(n,l),p=document.createElement("tr");if(p.className=this.theme.classOf("bodyRow","vt-row"),p.dataset.rowId=d,p.setAttribute("role","row"),this.options.fixedTopRows&&l<this.options.fixedTopRows&&H(p,this.theme.classOf("fixedTopRow","vt-fixed-top-row")),this.options.expandableRows){let u=document.createElement("td");u.className=this.theme.classOf("expandCell","vt-expand-cell"),i(u,0);let c=document.createElement("button");c.type="button",c.className=this.theme.classOf("expandTrigger","vt-expand-trigger"),c.dataset.rowId=d,c.textContent=r.expandedRowIds.has(d)?"\u2212":"+",c.setAttribute("aria-expanded",String(r.expandedRowIds.has(d))),u.appendChild(c),p.appendChild(u)}if(e.forEach((u,c)=>{let m=document.createElement("td");m.className=this.theme.classOf("bodyCell","vt-cell"),m.setAttribute("role","gridcell"),m.dataset.key=u.key,m.dataset.rowId=d,i(m,c+(this.options.expandableRows?1:0)),r.columnWidths[u.key]&&(m.style.width=`${r.columnWidths[u.key]}px`);let f=n[u.key];m.innerHTML=u.render?u.render(f,n):ht(String(f??"")),r.editableRows&&u.editable!==!1&&r.editableColumns[u.key]!==!1&&H(m,this.theme.classOf("editableCell","vt-cell-editable")),p.appendChild(m)}),this.options.rowActions.length){let u=document.createElement("td");u.className=this.theme.classOf("actionsCell","vt-actions-cell"),u.setAttribute("role","gridcell"),this.options.rowActions.forEach(c=>{let m=document.createElement("button");m.type="button",m.className=`${this.theme.classOf("actionButton","vt-action-btn")} ${c.className||""}`.trim(),m.dataset.actionId=c.id,m.dataset.rowId=d,m.textContent=c.label,u.appendChild(m)}),p.appendChild(u)}if(t.appendChild(p),this.hooks.afterRowRender?.({row:n,element:p}),this.options.expandableRows&&r.expandedRowIds.has(d)&&r.expandRow){let u=document.createElement("tr");u.className=this.theme.classOf("expandRow","vt-expand-row");let c=document.createElement("td");c.colSpan=e.length+1+(this.options.rowActions.length?1:0),c.className=this.theme.classOf("expandContent","vt-expand-content"),c.innerHTML=r.expandRow(n),u.appendChild(c),t.appendChild(u)}}),r.virtualization.enabled&&r.virtualization.end<s.length){let n=document.createElement("tr");n.className="vt-virtual-bottom";let a=document.createElement("td");a.colSpan=e.length+(this.options.expandableRows?1:0)+(this.options.rowActions.length?1:0),a.style.height=`${(s.length-r.virtualization.end)*r.virtualization.rowHeight}px`,a.style.padding="0",a.style.border="none",n.appendChild(a),t.appendChild(n)}}};function ht(h){return h.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function H(h,t){t.split(/\s+/).filter(Boolean).forEach(e=>{h.classList.add(e)})}var T=class{constructor({options:t}){this.options=t}render(t,{page:e,totalPages:s,totalRows:r,loading:i}){t.info.textContent=i?this.options.labels.loading:this.options.labels.pageInfo({page:e,totalPages:s,totalRows:r}),t.first.disabled=!!i||e<=1,t.prev.disabled=!!i||e<=1,t.next.disabled=!!i||e>=s,t.last.disabled=!!i||e>=s}};var E=class{constructor(t={}){this.classes=t}setClasses(t){this.classes=t||{}}classOf(t,e){let s=this.classes?.[t];return s?`${e} ${s}`:e}};var A=class{constructor({root:t,options:e,hooks:s}){this.root=t,this.options=e,this.hooks=s,this.refs={},this.theme=new E(this.options.themeClasses),this.shellRenderer=new C({root:this.root,options:this.options,theme:this.theme}),this.headerRenderer=new k({options:this.options,theme:this.theme}),this.bodyRenderer=new R({options:this.options,hooks:this.hooks,theme:this.theme}),this.footerRenderer=new T({options:this.options})}setOptions(t){this.options=t,this.theme.setClasses(this.options.themeClasses),this.shellRenderer.options=this.options,this.headerRenderer.options=this.options,this.bodyRenderer.options=this.options,this.footerRenderer.options=this.options}mount(){this.refs=this.shellRenderer.mount()}renderHeader(t,e,s,r){this.headerRenderer.render(this.refs.thead,t,e,s,(i,o)=>this.applyFixedColumn(i,o,t,r),r)}renderBody(t,e,s){this.bodyRenderer.render(this.refs.tbody,t,e,s,(r,i)=>this.applyFixedColumn(r,i,t,s.columnWidths))}renderFooter(t){this.footerRenderer.render({info:this.refs.info,first:this.refs.first,prev:this.refs.prev,next:this.refs.next,last:this.refs.last},t)}applyFixedColumn(t,e,s,r){if(!this.options.fixedColumns||e>=this.options.fixedColumns)return;let i=0;for(let o=0;o<e;o+=1){let n=s[o]?.key;i+=n&&r[n]?r[n]:180}t.style.position="sticky",t.style.left=`${i}px`,t.style.zIndex="2",ct(t,this.theme.classOf("fixedColumn","vt-fixed-column"))}};function ct(h,t){t.split(/\s+/).filter(Boolean).forEach(e=>{h.classList.add(e)})}var M=class{constructor({size:t,timeoutMs:e,retries:s}){this.size=Math.max(1,Number(t||1)),this.workers=[],this.pending=new Map,this.nextId=1,this.timeoutMs=Math.max(50,Number(e||4e3)),this.retries=Math.max(0,Math.floor(Number(s||1))),this.rows=[];for(let r=0;r<this.size;r+=1)this.workers.push({worker:this.createWorker()})}destroy(){for(let t of this.workers)t.worker.terminate();this.workers=[],this.pending.clear()}setRows(t){let e=Array.isArray(t)?t:[];this.rows=e;let s=Math.ceil((e.length||1)/this.workers.length);return Promise.all(this.workers.map((r,i)=>{let o=i*s,n=Math.min(o+s,e.length);return this.runTask(r.worker,{type:"setRows",rows:e.slice(o,n),offset:o}).then(()=>{})})).then(()=>{})}project(t){return Promise.all(this.workers.map(e=>this.runTask(e.worker,{type:"project",keys:t.keys,searchTerm:t.searchTerm,columnFilters:t.columnFilters,sorts:t.sorts}))).then(e=>this.mergeChunks(e,t.sorts))}createWorker(){let t=new Worker(dt());return t.onmessage=e=>{let s=e.data||{},r=this.pending.get(s.id);if(r){if(this.pending.delete(s.id),s.error){r.reject(new Error(s.error));return}r.resolve(s.result)}},t.onerror=()=>{this.pending.forEach(({reject:e})=>e(new Error("projection worker failed"))),this.pending.clear()},t}runTask(t,e){return this.runTaskAttempt(t,e,this.retries)}runTaskAttempt(t,e,s){let r=this.nextId;this.nextId+=1;let i;return new Promise((o,n)=>{let a=d=>{if(clearTimeout(i),s>0){this.runTaskAttempt(t,e,s-1).then(o).catch(n);return}n(d)},l=d=>{clearTimeout(i),o(d)};this.pending.set(r,{resolve:l,reject:a}),i=setTimeout(()=>{this.pending.delete(r),a(new Error(`projection worker timeout after ${this.timeoutMs}ms`))},this.timeoutMs),t.postMessage({...e,id:r})})}mergeChunks(t,e){if(!Array.isArray(t)||!t.length)return[];if(!Array.isArray(e)||!e.length)return t.flat();let s=new Int32Array(t.length),r=[];for(;;){let i=-1,o=-1;for(let n=0;n<t.length;n+=1){let a=s[n],l=t[n];if(a>=l.length)continue;let d=l[a];if(i===-1){i=n,o=d;continue}let p=ut(this.rows[d],this.rows[o],e);(p<0||p===0&&d<o)&&(i=n,o=d)}if(i===-1)break;r.push(o),s[i]+=1}return r}},I=null;function dt(){if(I)return I;let h=`
    const toText = (value) => String(value ?? '').toLowerCase();

    let rows = [];
    let offset = 0;

    self.onmessage = (event) => {
      const data = event.data || {};

      try {
        if (data.type === 'setRows') {
          rows = Array.isArray(data.rows) ? data.rows : [];
          offset = Number(data.offset || 0);
          self.postMessage({ id: data.id, result: true });
          return;
        }

        if (data.type === 'project') {
          const keys = Array.isArray(data.keys) ? data.keys : [];
          const searchTerm = toText(data.searchTerm || '');
          const sorts = Array.isArray(data.sorts) ? data.sorts : [];
          const filters = data.columnFilters && typeof data.columnFilters === 'object'
            ? data.columnFilters
            : {};
          const filterEntries = Object.entries(filters);
          const output = [];

          for (let i = 0; i < rows.length; i += 1) {
            const row = rows[i];
            let matchesFilters = true;

            for (const [key, term] of filterEntries) {
              if (!toText(row && row[key]).includes(toText(term))) {
                matchesFilters = false;
                break;
              }
            }
            if (!matchesFilters) continue;

            if (!searchTerm) {
              output.push(offset + i);
              continue;
            }

            let matchesSearch = false;
            for (const key of keys) {
              if (toText(row && row[key]).includes(searchTerm)) {
                matchesSearch = true;
                break;
              }
            }
            if (matchesSearch) output.push(offset + i);
          }

          if (sorts.length > 0) {
            output.sort((leftIndex, rightIndex) => {
              const leftRow = rows[leftIndex - offset];
              const rightRow = rows[rightIndex - offset];
              for (const sort of sorts) {
                const leftRaw = leftRow ? leftRow[sort.key] : null;
                const rightRaw = rightRow ? rightRow[sort.key] : null;
                const leftNum = Number(leftRaw);
                const rightNum = Number(rightRaw);
                const leftFinite = Number.isFinite(leftNum);
                const rightFinite = Number.isFinite(rightNum);

                let cmp = 0;
                if (leftFinite && rightFinite) {
                  cmp = leftNum - rightNum;
                } else {
                  const leftText = toText(leftRaw);
                  const rightText = toText(rightRaw);
                  if (leftText < rightText) cmp = -1;
                  else if (leftText > rightText) cmp = 1;
                }

                if (cmp !== 0) return sort.direction === 'desc' ? -cmp : cmp;
              }
              return leftIndex - rightIndex;
            });
          }

          self.postMessage({ id: data.id, result: output });
          return;
        }

        self.postMessage({ id: data.id, result: null });
      } catch (error) {
        self.postMessage({ id: data.id, error: error && error.message ? error.message : 'worker error' });
      }
    };
  `;return I=URL.createObjectURL(new Blob([h],{type:"application/javascript"})),I}function ut(h,t,e){for(let s of e){let r=h?.[s.key],i=t?.[s.key],o=Number(r),n=Number(i),a=Number.isFinite(o),l=Number.isFinite(n),d=0;if(a&&l)d=o-n;else{let p=String(r??"").toLowerCase(),u=String(i??"").toLowerCase();p<u?d=-1:p>u&&(d=1)}if(d!==0)return s.direction==="desc"?-d:d}return 0}var F=class{constructor({rows:t,pageSize:e,initialSort:s,parallel:r}){this.rows=t,this.state={page:1,pageSize:e,searchTerm:"",columnFilters:{},sorts:s?[{key:s.key,direction:s.direction||"asc"}]:[],columnOrder:[],columnWidths:{},columnVisibility:{}},this.rowsVersion=0,this.revision=0,this.filterCache=null,this.projectionCache=null,this.columnIndexCache=null;let i=ft(r?.workers);this.parallel={enabled:r?.enabled!==!1,threshold:Math.max(1e3,Number(r?.threshold??2e4)),workers:i,timeoutMs:Math.max(50,Number(r?.timeoutMs??4e3)),retries:Math.max(0,Math.floor(Number(r?.retries??1)))},this.projectionWorkerPool=null,this.projectionWorkerReady=Promise.resolve(),this.parallel.enabled&&typeof Worker<"u"&&(this.projectionWorkerPool=new M({size:this.parallel.workers,timeoutMs:this.parallel.timeoutMs,retries:this.parallel.retries}),this.projectionWorkerReady=this.projectionWorkerPool.setRows(this.rows).catch(()=>{this.projectionWorkerPool?.destroy(),this.projectionWorkerPool=null}))}setRows(t){this.rows=Array.isArray(t)?t:[],this.rowsVersion+=1,this.invalidateFiltersAndProjection(),this.columnIndexCache=null,this.syncWorkerRows()}setSearchTerm(t){this.state.searchTerm=(t||"").toLowerCase().trim(),this.state.page=1,this.invalidateFiltersAndProjection()}setColumnFilter(t,e){let s=(e||"").toLowerCase().trim();s?this.state.columnFilters[t]=s:delete this.state.columnFilters[t],this.state.page=1,this.invalidateFiltersAndProjection()}clearFilters(){this.state.searchTerm="",this.state.columnFilters={},this.state.page=1,this.invalidateFiltersAndProjection()}setPage(t){this.state.page=Math.max(1,t)}setPageSize(t){this.state.pageSize=t,this.state.page=1}toggleSort(t,e,s){let r=this.state.sorts.findIndex(o=>o.key===t);if(!e){if(r===-1)this.state.sorts=[{key:t,direction:"asc"}];else{let o=this.state.sorts[r];this.state.sorts=[{key:t,direction:o.direction==="asc"?"desc":"asc"}]}this.invalidateProjection();return}if(r===-1){this.state.sorts.push({key:t,direction:"asc"}),this.state.sorts.length>s&&this.state.sorts.shift(),this.invalidateProjection();return}let i=this.state.sorts[r];this.state.sorts[r]={key:t,direction:i.direction==="asc"?"desc":"asc"},this.invalidateProjection()}setSorts(t){this.state.sorts=Array.isArray(t)?t:[],this.state.page=1,this.invalidateProjection()}clearSorts(){this.state.sorts=[],this.state.page=1,this.invalidateProjection()}setColumnOrder(t){this.state.columnOrder=Array.isArray(t)?[...t]:[]}setColumnWidth(t,e){let s=Math.max(60,Math.round(e||0));this.state.columnWidths[t]=s}setColumnVisibility(t,e){this.state.columnVisibility[t]=!!e}setState(t){if(!t)return;let e=!1,s=!1;typeof t.page=="number"&&(this.state.page=Math.max(1,t.page)),typeof t.pageSize=="number"&&(this.state.pageSize=t.pageSize),typeof t.searchTerm=="string"&&(this.state.searchTerm=t.searchTerm,e=!0,s=!0),t.columnFilters&&typeof t.columnFilters=="object"&&(this.state.columnFilters={...t.columnFilters},e=!0,s=!0),Array.isArray(t.sorts)&&(this.state.sorts=[...t.sorts],e=!0),Array.isArray(t.columnOrder)&&(this.state.columnOrder=[...t.columnOrder]),t.columnWidths&&typeof t.columnWidths=="object"&&(this.state.columnWidths={...t.columnWidths}),t.columnVisibility&&typeof t.columnVisibility=="object"&&(this.state.columnVisibility={...t.columnVisibility}),s?this.invalidateFiltersAndProjection():e&&this.invalidateProjection()}getState(){return{page:this.state.page,pageSize:this.state.pageSize,searchTerm:this.state.searchTerm,columnFilters:{...this.state.columnFilters},sorts:[...this.state.sorts],columnOrder:[...this.state.columnOrder],columnWidths:{...this.state.columnWidths},columnVisibility:{...this.state.columnVisibility}}}getOrderedColumns(t){if(!this.state.columnOrder.length)return t;let e=new Map(t.map(o=>[o.key,o])),s=this.state.columnOrder.map(o=>e.get(o)).filter(Boolean),r=new Set(s.map(o=>o.key)),i=t.filter(o=>!r.has(o.key));return[...s,...i]}getVisibleColumns(t){return t.filter(e=>this.state.columnVisibility[e.key]!==!1)}getQuery(){return{page:this.state.page,pageSize:this.state.pageSize,searchTerm:this.state.searchTerm,columnFilters:{...this.state.columnFilters},sorts:[...this.state.sorts]}}getVisibleRows(t){let e=this.getProjectedRows(t),{page:s,pageSize:r}=this.state,i=(s-1)*r;return{rows:e.slice(i,i+r),totalRows:e.length,totalPages:Math.max(1,Math.ceil(e.length/r))}}getVisibleRowsAsync(t){return this.getProjectedRowsAsync(t).then(e=>{let{page:s,pageSize:r}=this.state,i=(s-1)*r;return{rows:e.slice(i,i+r),totalRows:e.length,totalPages:Math.max(1,Math.ceil(e.length/r))}})}applyColumnFilters(t,e){let s=new Set(e.map(o=>o.key)),r=Object.entries(this.state.columnFilters).filter(([o])=>s.has(o));if(!r.length)return t;if(t===this.rows){let o=this.getColumnIndex(e),n=r.map(([l,d])=>({term:d,text:this.getIndexedText(o,l)})),a=[];for(let l=0;l<t.length;l+=1){let d=!0;for(let p of n)if(!p.text[l].includes(p.term)){d=!1;break}d&&a.push(t[l])}return a}let i=[];for(let o of t){let n=!0;for(let[a,l]of r)if(!String(o?.[a]??"").toLowerCase().includes(l)){n=!1;break}n&&i.push(o)}return i}applySearch(t,e){if(!this.state.searchTerm)return t;let s=e.map(i=>i.key);if(t===this.rows){let i=this.getColumnIndex(e),n=this.getSearchableKeys(i,s,this.state.searchTerm).map(l=>this.getIndexedText(i,l)),a=[];for(let l=0;l<t.length;l+=1){let d=!1;for(let p of n)if(p[l].includes(this.state.searchTerm)){d=!0;break}d&&a.push(t[l])}return a}let r=[];for(let i of t){let o=!1;for(let n of s)if(String(i?.[n]??"").toLowerCase().includes(this.state.searchTerm)){o=!0;break}o&&r.push(i)}return r}applySort(t,e){return this.applySortWithCache(t,e)}invalidateProjection(){this.revision+=1,this.projectionCache=null}invalidateFiltersAndProjection(){this.filterCache=null,this.invalidateProjection()}syncWorkerRows(){this.projectionWorkerPool&&(this.projectionWorkerReady=this.projectionWorkerPool.setRows(this.rows).catch(()=>{this.projectionWorkerPool?.destroy(),this.projectionWorkerPool=null}))}canUseWorkerProjection(){if(!this.projectionWorkerPool||this.rows.length<this.parallel.threshold)return!1;let t=!!this.state.searchTerm||!!Object.keys(this.state.columnFilters).length,e=!!this.state.sorts.length;return!(!t&&!e)}destroy(){this.projectionWorkerPool?.destroy(),this.projectionWorkerPool=null}getProjectedRows(t){let e=this.getColumnsKey(t);if(this.projectionCache&&this.projectionCache.revision===this.revision&&this.projectionCache.columnsKey===e)return this.projectionCache.rows;let s=this.getFilteredRows(t,e),r=this.applySortWithCache(s,t);if(!this.state.searchTerm&&!Object.keys(this.state.columnFilters).length&&this.rows.length>2e4){let i=this.getColumnIndex(t);for(let o of t)this.getIndexedText(i,o.key),this.getIndexedNumeric(i,o.key),this.hasAlphaValues(i,o.key)}return this.projectionCache={revision:this.revision,columnsKey:e,rows:r},r}getProjectedRowsAsync(t){let e=this.getColumnsKey(t);return this.projectionCache&&this.projectionCache.revision===this.revision&&this.projectionCache.columnsKey===e?Promise.resolve(this.projectionCache.rows):this.canUseWorkerProjection()?this.getProjectedRowsFromWorkers(t,e):this.getFilteredRowsWithWorkersAsync(t,e).then(s=>{let r=this.applySortWithCache(s,t);if(!this.state.searchTerm&&!Object.keys(this.state.columnFilters).length&&this.rows.length>2e4){let i=this.getColumnIndex(t);for(let o of t)this.getIndexedText(i,o.key),this.getIndexedNumeric(i,o.key),this.hasAlphaValues(i,o.key)}return this.projectionCache={revision:this.revision,columnsKey:e,rows:r},r})}getProjectedRowsFromWorkers(t,e){let s=this.state.searchTerm,r=this.serializeActiveFilters(t);return this.projectionWorkerReady.then(()=>this.projectionWorkerPool.project({keys:t.map(i=>i.key),searchTerm:s,columnFilters:this.state.columnFilters,sorts:this.state.sorts})).then(i=>{let o=i.map(n=>this.rows[n]).filter(Boolean);return this.filterCache={rowsVersion:this.rowsVersion,columnsKey:e,searchTerm:s,filtersKey:r,rows:o},this.projectionCache={revision:this.revision,columnsKey:e,rows:o},o}).catch(()=>(this.projectionWorkerPool?.destroy(),this.projectionWorkerPool=null,Promise.resolve(this.getProjectedRows(t))))}getFilteredRows(t,e){let s=this.state.searchTerm,r=this.serializeActiveFilters(t);if(this.filterCache&&this.filterCache.rowsVersion===this.rowsVersion&&this.filterCache.columnsKey===e&&this.filterCache.searchTerm===s&&this.filterCache.filtersKey===r)return this.filterCache.rows;let i=this.applyFiltersAndSearch(this.rows,t);return this.filterCache={rowsVersion:this.rowsVersion,columnsKey:e,searchTerm:s,filtersKey:r,rows:i},i}getFilteredRowsWithWorkersAsync(t,e){let s=this.state.searchTerm,r=this.serializeActiveFilters(t);if(this.filterCache&&this.filterCache.rowsVersion===this.rowsVersion&&this.filterCache.columnsKey===e&&this.filterCache.searchTerm===s&&this.filterCache.filtersKey===r)return Promise.resolve(this.filterCache.rows);if(!this.canUseWorkerProjection()){let i=this.applyFiltersAndSearch(this.rows,t);return this.filterCache={rowsVersion:this.rowsVersion,columnsKey:e,searchTerm:s,filtersKey:r,rows:i},Promise.resolve(i)}return this.projectionWorkerReady.then(()=>this.projectionWorkerPool.project({keys:t.map(i=>i.key),searchTerm:s,columnFilters:this.state.columnFilters,sorts:[]})).then(i=>{let o=i.map(n=>this.rows[n]).filter(Boolean);return this.filterCache={rowsVersion:this.rowsVersion,columnsKey:e,searchTerm:s,filtersKey:r,rows:o},o}).catch(()=>{this.projectionWorkerPool?.destroy(),this.projectionWorkerPool=null;let i=this.applyFiltersAndSearch(this.rows,t);return this.filterCache={rowsVersion:this.rowsVersion,columnsKey:e,searchTerm:s,filtersKey:r,rows:i},i})}applyFiltersAndSearch(t,e){let s=e.map(a=>a.key),r=new Set(s),i=Object.entries(this.state.columnFilters).filter(([a])=>r.has(a)),o=this.state.searchTerm;if(!i.length&&!o)return t;if(t===this.rows){let a=this.getColumnIndex(e),l=i.map(([u,c])=>({term:c,text:this.getIndexedText(a,u)})),d=o?this.getSearchableKeys(a,s,o).map(u=>this.getIndexedText(a,u)):null,p=[];for(let u=0;u<t.length;u+=1){let c=!0;for(let f of l)if(!f.text[u].includes(f.term)){c=!1;break}if(!c)continue;if(!d){p.push(t[u]);continue}let m=!1;for(let f of d)if(f[u].includes(o)){m=!0;break}m&&p.push(t[u])}return p}let n=[];for(let a of t){let l=!0;for(let[p,u]of i)if(!String(a?.[p]??"").toLowerCase().includes(u)){l=!1;break}if(!l)continue;if(!o){n.push(a);continue}let d=!1;for(let p of s)if(String(a?.[p]??"").toLowerCase().includes(o)){d=!0;break}d&&n.push(a)}return n}applySortWithCache(t,e){if(!this.state.sorts.length)return t;let s=new Set(e.map(c=>c.key)),r=this.state.sorts.filter(c=>s.has(c.key));if(!r.length)return t;let i=t.length,o=Array.from({length:i}).map((c,m)=>m),n=this.getColumnIndex(e),a=new Int32Array(i),l=!0;for(let c=0;c<i;c+=1){let m=n.rowIndex.get(t[c]);if(m===void 0){l=!1;break}a[c]=m}let d=r.map(c=>{let m=new Array(i),f=new Float64Array(i),g=new Uint8Array(i),y=l?this.getIndexedText(n,c.key):null,v=l?this.getIndexedNumeric(n,c.key):null;for(let w=0;w<i;w+=1){if(y&&v){let W=a[w];m[w]=y[W],g[w]=v.flags[W],f[w]=v.values[W];continue}let V=t[w]?.[c.key],$=Number(V);m[w]=String(V??"").toLowerCase(),Number.isFinite($)&&(g[w]=1,f[w]=$)}return{direction:c.direction,multiplier:c.direction==="desc"?-1:1,text:m,num:f,isNum:g}}),p=d.length===1?(c,m)=>{let f=d[0];if(f.isNum[c]&&f.isNum[m]){let y=f.num[c]-f.num[m];if(y!==0)return y*f.multiplier}else{let y=f.text[c],v=f.text[m];if(y<v)return-1*f.multiplier;if(y>v)return 1*f.multiplier}return c-m}:(c,m)=>{for(let f of d){if(f.isNum[c]&&f.isNum[m]){let w=f.num[c]-f.num[m];if(w!==0)return w*f.multiplier;continue}let y=f.text[c],v=f.text[m];if(y<v)return-1*f.multiplier;if(y>v)return 1*f.multiplier}return c-m};i<5e3?mt(o,p):o.sort(p);let u=new Array(i);for(let c=0;c<i;c+=1)u[c]=t[o[c]];return u}getColumnsKey(t){return t.map(e=>e.key).join("|")}serializeActiveFilters(t){let e=new Set(t.map(r=>r.key)),s=Object.entries(this.state.columnFilters).filter(([r])=>e.has(r)).sort(([r],[i])=>pt(r,i));return s.length?s.map(([r,i])=>`${r}:${i}`).join("|"):""}getColumnIndex(t){let e=this.getColumnsKey(t);if(this.columnIndexCache&&this.columnIndexCache.rowsVersion===this.rowsVersion&&this.columnIndexCache.columnsKey===e&&this.columnIndexCache.rows===this.rows)return this.columnIndexCache;let s=new WeakMap;for(let r=0;r<this.rows.length;r+=1)s.set(this.rows[r],r);return this.columnIndexCache={rowsVersion:this.rowsVersion,columnsKey:e,rows:this.rows,textByKey:new Map,rowIndex:s,numericByKey:new Map,hasAlphaByKey:new Map},this.columnIndexCache}getIndexedText(t,e){let s=t.textByKey.get(e);if(s)return s;let r=new Array(t.rows.length);for(let i=0;i<t.rows.length;i+=1)r[i]=String(t.rows[i]?.[e]??"").toLowerCase();return t.textByKey.set(e,r),r}getIndexedNumeric(t,e){let s=t.numericByKey.get(e);if(s)return s;let r=new Float64Array(t.rows.length),i=new Uint8Array(t.rows.length);for(let n=0;n<t.rows.length;n+=1){let a=Number(t.rows[n]?.[e]);Number.isFinite(a)&&(r[n]=a,i[n]=1)}let o={values:r,flags:i};return t.numericByKey.set(e,o),o}getSearchableKeys(t,e,s){if(!K.test(s))return e;let r=e.filter(i=>this.hasAlphaValues(t,i));return r.length?r:e}hasAlphaValues(t,e){let s=t.hasAlphaByKey.get(e);if(s!==void 0)return s;let r=this.getIndexedText(t,e),i=!1;for(let o=0;o<r.length;o+=1)if(K.test(r[o])){i=!0;break}return t.hasAlphaByKey.set(e,i),i}},K=/[a-z]/;function pt(h,t){return h<t?-1:h>t?1:0}function mt(h,t){let e=h.length;if(e<2)return;let s=new Array(e),r=1;for(;r<e;){for(let i=0;i<e;i+=r*2){let o=Math.min(i+r,e),n=Math.min(i+r*2,e),a=i,l=o,d=i;for(;a<o&&l<n;)t(h[a],h[l])<=0?(s[d]=h[a],a+=1):(s[d]=h[l],l+=1),d+=1;for(;a<o;)s[d]=h[a],a+=1,d+=1;for(;l<n;)s[d]=h[l],l+=1,d+=1}for(let i=0;i<e;i+=1)h[i]=s[i];r*=2}}function ft(h){if(typeof h=="number"&&Number.isFinite(h))return Math.max(1,Math.floor(h));if(h==="auto"||h==null){let e=typeof navigator<"u"&&Number.isFinite(navigator.hardwareConcurrency)?navigator.hardwareConcurrency:4;return Math.max(2,Math.min(8,Math.floor(e)-1))}let t=Number(h);return Number.isFinite(t)?Math.max(1,Math.floor(t)):4}function L(h,t){let e={...h};for(let s of Object.keys(t||{})){let r=e[s],i=t[s];U(r)&&U(i)?e[s]=L(r,i):e[s]=i}return e}function U(h){return h!==null&&typeof h=="object"&&!Array.isArray(h)}var P=class{constructor(){this.listeners=new Map}on(t,e){let s=this.listeners.get(t)||[];return s.push(e),this.listeners.set(t,s),()=>this.off(t,e)}off(t,e){let s=this.listeners.get(t);s&&this.listeners.set(t,s.filter(r=>r!==e))}emit(t,e){let s=this.listeners.get(t);if(s)for(let r of s)r(e)}};var B=class{constructor({store:t}){this.store=t}getView({columns:t}){return typeof this.store.getVisibleRowsAsync=="function"&&typeof this.store.canUseWorkerProjection=="function"&&this.store.canUseWorkerProjection()?this.store.getVisibleRowsAsync(t):Promise.resolve(this.store.getVisibleRows(t))}};var j=class{constructor({store:t,fetchData:e,onLoadingChange:s}){this.store=t,this.fetchData=e,this.onLoadingChange=s}getView(){if(typeof this.fetchData!="function")return Promise.reject(new Error("VanillaTable serverSide mode requires options.fetchData(query)."));this.onLoadingChange(!0);let t=this.store.getQuery();return Promise.resolve(this.fetchData(t)).then(e=>{let s=Array.isArray(e?.rows)?e.rows:[],r=Number(e?.totalRows||s.length);return this.store.setRows(s),{rows:s,totalRows:r,totalPages:Math.max(1,Math.ceil(r/this.store.state.pageSize))}}).finally(()=>{this.onLoadingChange(!1)})}};function q({options:h,store:t,onLoadingChange:e}){return h.serverSide?new j({store:t,fetchData:h.fetchData,onLoadingChange:e}):new B({store:t})}var z=class{constructor({persistence:t,urlSync:e,tableId:s}){this.persistence=t,this.urlSync=e,this.tableId=s}load(){let t=this.loadFromUrl();return{...this.loadFromStorage(),...t}}save(t){this.persistence.enabled&&this.saveToStorage(t),this.urlSync.enabled&&this.saveToUrl(t)}loadFromStorage(){if(!this.persistence.enabled||typeof window>"u")return{};let t=this.getStorageKey();try{let e=window.localStorage.getItem(t);if(!e)return{};let s=JSON.parse(e);return s&&typeof s=="object"?s:{}}catch{return{}}}saveToStorage(t){if(!(typeof window>"u"))try{window.localStorage.setItem(this.getStorageKey(),JSON.stringify(t))}catch{}}loadFromUrl(){if(!this.urlSync.enabled||typeof window>"u")return{};try{let e=new URLSearchParams(window.location.search).get(this.urlSync.param||"vt");if(!e)return{};let s=decodeURIComponent(e),r=JSON.parse(s);return r&&typeof r=="object"?r:{}}catch{return{}}}saveToUrl(t){if(!(typeof window>"u"))try{let e=new URLSearchParams(window.location.search);e.set(this.urlSync.param||"vt",encodeURIComponent(JSON.stringify(t)));let s=`${window.location.pathname}?${e.toString()}${window.location.hash}`;window.history.replaceState({},"",s)}catch{}}getStorageKey(){return this.persistence.storageKey||`vanilla-tables:${this.tableId}`}};var S=class{constructor(t,e,s={}){if(!(t instanceof HTMLElement))throw new Error("VanillaTable requires a valid HTMLElement as first argument.");this.root=t,this.rows=Array.isArray(e)?e:[],this.options=L(N,s),this.options.i18n={...N.i18n,...this.options.i18n||{}},this.options.labels={...this.options.labels,search:this.options.i18n.search||this.options.labels.search,filter:this.options.i18n.filter||this.options.labels.filter,rows:this.options.i18n.rows||this.options.labels.rows,actions:this.options.i18n.actions||this.options.labels.actions,loading:this.options.i18n.loading||this.options.labels.loading,empty:this.options.i18n.empty||this.options.labels.empty,first:this.options.i18n.first||this.options.labels.first,prev:this.options.i18n.prev||this.options.labels.prev,next:this.options.i18n.next||this.options.labels.next,last:this.options.i18n.last||this.options.labels.last,pageInfo:typeof this.options.i18n.pageInfo=="string"?({page:i,totalPages:o,totalRows:n})=>this.options.i18n.pageInfo.replace("{page}",String(i)).replace("{totalPages}",String(o)).replace("{totalRows}",String(n)):this.options.labels.pageInfo},this.options.columns.length||(this.options.columns=D(this.rows)),this.events=new P,this.hooks={},this.store=new F({rows:this.rows,pageSize:this.options.pageSize,initialSort:this.options.initialSort,parallel:this.options.parallel});let r=this.options.columns.map(i=>i.key);this.store.setColumnOrder(r),this.renderer=new A({root:t,options:this.options,hooks:this.hooks}),this.dataSource=q({options:this.options,store:this.store,onLoadingChange:i=>this.handleLoadingChange(i)}),this.stateSync=new z({persistence:this.options.persistence,urlSync:this.options.urlSync,tableId:this.getTableId()}),this.expandedRowIds=new Set,this.searchTimer=null,this.loading=!1,this.lastView={rows:[],totalRows:0,totalPages:1},this.lastAnimationFrame=null,this.virtualization={enabled:!!this.options.virtualScroll.enabled,start:0,end:this.options.pageSize,rowHeight:this.options.virtualScroll.rowHeight},this.applySyncedState()}init(){return this.renderer.mount(),this.bindEvents(),this.refresh(),this.emitEvent("init",{instance:this}),this}refresh(){let t=this.store.getVisibleColumns(this.store.getOrderedColumns(this.options.columns));return this.dataSource.getView({columns:t}).then(e=>{if(!t.length&&e.rows.length&&(this.options.columns=D(e.rows),this.store.setColumnOrder(this.options.columns.map(s=>s.key)),t=this.store.getVisibleColumns(this.store.getOrderedColumns(this.options.columns))),this.store.state.page>e.totalPages)return this.store.setPage(e.totalPages),this.refresh();this.lastView=e,this.virtualization=this.computeVirtualWindow(e.rows.length),this.renderer.renderHeader(t,this.store.state.sorts,this.store.state.columnFilters,this.store.state.columnWidths),this.renderer.renderBody(t,e.rows,{expandedRowIds:this.expandedRowIds,getRowId:(s,r)=>this.getRowId(s,r),expandRow:this.options.expandRow,editableRows:this.options.editableRows,editableColumns:this.options.editableColumns,columnWidths:this.store.state.columnWidths,virtualization:this.virtualization}),this.renderer.renderFooter({page:this.store.state.page,totalPages:e.totalPages,totalRows:e.totalRows,loading:this.loading}),this.renderer.refs.table?.setAttribute("aria-rowcount",String(e.totalRows)),this.persistState(),this.emitEvent("change",{state:this.getState(),view:e}),this.emitEvent("state:change",this.getState())}).catch(e=>{this.emitEvent("error",{error:e})})}handleLoadingChange(t){this.loading=t,this.renderer.renderFooter({page:this.store.state.page,totalPages:1,totalRows:0,loading:t}),this.emitEvent("loading:change",{loading:t})}bindEvents(){this.bindSearchEvents(),this.bindSortEvents(),this.bindFilterEvents(),this.bindPaginationEvents(),this.bindExpandEvents(),this.bindEditEvents(),this.bindActionEvents(),this.bindColumnResizeEvents(),this.bindColumnReorderEvents(),this.bindVirtualScrollEvents(),this.bindKeyboardA11yEvents()}bindSearchEvents(){this.renderer.refs.search?.addEventListener("input",t=>{this.searchTimer&&clearTimeout(this.searchTimer);let e=()=>{this.store.setSearchTerm(t.target.value),this.emitEvent("search:change",{term:this.store.state.searchTerm}),this.refresh()};if(this.options.debounceMs<=0){e();return}this.searchTimer=setTimeout(e,this.options.debounceMs)})}bindSortEvents(){this.renderer.refs.thead?.addEventListener("click",t=>{let e=t.target.closest(".vt-sort-trigger");!e||e.disabled||(this.store.toggleSort(e.dataset.key,this.options.multiSort&&t.shiftKey,this.options.maxSorts),this.emitEvent("sort:change",{sorts:[...this.store.state.sorts]}),this.refresh())})}bindFilterEvents(){this.renderer.refs.thead?.addEventListener("input",t=>{let e=t.target.closest(".vt-column-filter");e&&(this.store.setColumnFilter(e.dataset.key,e.value),this.emitEvent("filter:change",{key:e.dataset.key,value:this.store.state.columnFilters[e.dataset.key]||""}),this.refresh())})}bindPaginationEvents(){this.renderer.refs.pageSize?.addEventListener("change",t=>{this.store.setPageSize(Number(t.target.value)),this.emitEvent("pagesize:change",{pageSize:this.store.state.pageSize}),this.refresh()}),this.renderer.refs.prev?.addEventListener("click",()=>{this.store.setPage(this.store.state.page-1),this.emitEvent("page:change",{page:this.store.state.page}),this.refresh()}),this.renderer.refs.next?.addEventListener("click",()=>{this.store.setPage(this.store.state.page+1),this.emitEvent("page:change",{page:this.store.state.page}),this.refresh()}),this.renderer.refs.first?.addEventListener("click",()=>{this.store.setPage(1),this.emitEvent("page:change",{page:this.store.state.page}),this.refresh()}),this.renderer.refs.last?.addEventListener("click",()=>{this.store.setPage(this.lastView.totalPages||1),this.emitEvent("page:change",{page:this.store.state.page}),this.refresh()})}bindExpandEvents(){this.renderer.refs.tbody?.addEventListener("click",t=>{let e=t.target.closest(".vt-expand-trigger");if(!e)return;let s=e.dataset.rowId;this.toggleRow(s)})}bindEditEvents(){this.renderer.refs.tbody?.addEventListener("dblclick",t=>{if(!this.options.editableRows)return;let e=t.target.closest(".vt-cell-editable");if(!e||e.querySelector("input"))return;let s=e.dataset.rowId,r=e.dataset.key,i=this.findRowById(s);if(!i)return;let o=document.createElement("input");o.type="text",o.value=String(i[r]??""),o.className="vt-inline-input",e.innerHTML="",e.appendChild(o),o.focus();let n=()=>{i[r]=o.value,this.emitEvent("edit",{rowId:s,row:i,key:r,value:o.value}),this.emitEvent("row:edit",{rowId:s,row:i,key:r,value:o.value}),this.refresh()};o.addEventListener("blur",n,{once:!0}),o.addEventListener("keydown",a=>{a.key==="Enter"&&o.blur()})})}bindActionEvents(){this.renderer.refs.tbody?.addEventListener("click",t=>{let e=t.target.closest(".vt-action-btn");if(!e)return;let s=e.dataset.rowId,r=e.dataset.actionId,i=this.findRowById(s),o=this.options.rowActions.find(n=>n.id===r);!o||!i||Promise.resolve(o.onClick?o.onClick({row:i,rowId:s,actionId:r,table:this,event:t}):null).finally(()=>{this.emitEvent("row:action",{row:i,rowId:s,actionId:r})})})}bindColumnResizeEvents(){this.options.columnResize&&this.renderer.refs.thead?.addEventListener("mousedown",t=>{let e=t.target.closest(".vt-resize-handle");if(!e)return;t.preventDefault();let s=e.dataset.key,r=t.clientX,i=this.store.state.columnWidths[s]||this.renderer.refs.thead.querySelector(`th[data-key="${s}"]`)?.getBoundingClientRect().width||180,o=a=>{let l=i+(a.clientX-r);this.store.setColumnWidth(s,l),this.emitEvent("column:resize",{key:s,width:this.store.state.columnWidths[s]}),this.refresh()},n=()=>{window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",n),this.persistState()};window.addEventListener("mousemove",o),window.addEventListener("mouseup",n)})}bindColumnReorderEvents(){if(!this.options.columnReorder)return;let t=null;this.renderer.refs.thead?.addEventListener("dragstart",e=>{let s=e.target.closest("th[data-key]");s&&(t=s.dataset.key,e.dataTransfer.effectAllowed="move")}),this.renderer.refs.thead?.addEventListener("dragover",e=>{t&&(e.preventDefault(),e.dataTransfer.dropEffect="move")}),this.renderer.refs.thead?.addEventListener("drop",e=>{if(!t)return;e.preventDefault();let s=e.target.closest("th[data-key]");if(!s)return;let r=s.dataset.key;if(!r||r===t)return;let o=this.store.getOrderedColumns(this.options.columns).map(a=>a.key).filter(a=>a!==t),n=o.indexOf(r);o.splice(n,0,t),this.store.setColumnOrder(o),this.emitEvent("column:reorder",{order:o}),this.refresh(),t=null}),this.renderer.refs.thead?.addEventListener("dragend",()=>{t=null})}bindVirtualScrollEvents(){this.options.virtualScroll.enabled&&this.renderer.refs.tableWrap?.addEventListener("scroll",()=>{this.lastAnimationFrame&&cancelAnimationFrame(this.lastAnimationFrame),this.lastAnimationFrame=requestAnimationFrame(()=>{this.refresh()})})}bindKeyboardA11yEvents(){this.renderer.refs.thead?.addEventListener("keydown",t=>{let e=t.target.closest(".vt-resize-handle");if(e&&(t.key==="ArrowLeft"||t.key==="ArrowRight")){t.preventDefault();let r=e.dataset.key,i=this.store.state.columnWidths[r]||180,o=t.key==="ArrowLeft"?-16:16;this.setColumnWidth(r,i+o);return}let s=t.target.closest("th[data-key]");if(!(!s||!this.options.columnReorder)&&t.altKey&&(t.key==="ArrowLeft"||t.key==="ArrowRight")){t.preventDefault();let r=this.store.getOrderedColumns(this.options.columns).map(l=>l.key),i=s.dataset.key,o=r.indexOf(i);if(o<0)return;let n=t.key==="ArrowLeft"?Math.max(0,o-1):Math.min(r.length-1,o+1);if(n===o)return;let a=[...r];a.splice(o,1),a.splice(n,0,i),this.reorderColumns(a)}})}setData(t){return this.rows=Array.isArray(t)?t:[],this.store.setRows(this.rows),this.store.setPage(1),this.emitEvent("data:set",{count:this.rows.length}),this.refresh()}addRow(t){return this.store.setRows([...this.store.rows,t]),this.emitEvent("data:add",{row:t}),this.refresh()}removeRowById(t){return this.store.setRows(this.store.rows.filter((e,s)=>this.getRowId(e,s)!==String(t))),this.emitEvent("data:remove",{rowId:t}),this.refresh()}search(t){return this.store.setSearchTerm(t),this.emitEvent("search:change",{term:this.store.state.searchTerm}),this.refresh()}filterBy(t,e){return this.store.setColumnFilter(t,e),this.emitEvent("filter:change",{key:t,value:this.store.state.columnFilters[t]||""}),this.refresh()}clearFilters(){return this.store.clearFilters(),this.emitEvent("filter:clear",{}),this.refresh()}sortBy(t,e="asc",s=!1){if(!s)this.store.setSorts([{key:t,direction:e}]);else{let r=[...this.store.state.sorts.filter(i=>i.key!==t),{key:t,direction:e}];this.store.setSorts(r.slice(-this.options.maxSorts))}return this.emitEvent("sort:change",{sorts:[...this.store.state.sorts]}),this.refresh()}clearSort(){return this.store.clearSorts(),this.emitEvent("sort:clear",{}),this.refresh()}goToPage(t){return this.store.setPage(t),this.emitEvent("page:change",{page:this.store.state.page}),this.refresh()}setPageSize(t){return this.store.setPageSize(t),this.emitEvent("pagesize:change",{pageSize:this.store.state.pageSize}),this.refresh()}expandRow(t){return this.expandedRowIds.add(String(t)),this.emitEvent("row:expand",{rowId:String(t)}),this.refresh()}collapseRow(t){return this.expandedRowIds.delete(String(t)),this.emitEvent("row:collapse",{rowId:String(t)}),this.refresh()}toggleRow(t){let e=String(t);return this.expandedRowIds.has(e)?this.collapseRow(e):this.expandRow(e)}expandAllRows(){return this.store.rows.forEach((t,e)=>{this.expandedRowIds.add(this.getRowId(t,e))}),this.emitEvent("row:expandAll",{}),this.refresh()}collapseAllRows(){return this.expandedRowIds.clear(),this.emitEvent("row:collapseAll",{}),this.refresh()}updateCell(t,e,s){let r=this.findRowById(String(t));return r?(r[e]=s,this.emitEvent("edit",{rowId:String(t),row:r,key:e,value:s}),this.emitEvent("row:edit",{rowId:String(t),row:r,key:e,value:s}),this.refresh()):Promise.resolve()}setColumnEditable(t,e){return this.options.columns=this.options.columns.map(s=>s.key===t?{...s,editable:e}:s),this.options.editableColumns[t]=e,this.emitEvent("column:editable",{key:t,editable:e}),this.refresh()}setColumnWidth(t,e){return this.store.setColumnWidth(t,e),this.emitEvent("column:resize",{key:t,width:this.store.state.columnWidths[t]}),this.refresh()}reorderColumns(t){return this.store.setColumnOrder(t),this.emitEvent("column:reorder",{order:[...t]}),this.refresh()}setColumnVisibility(t,e){return this.store.setColumnVisibility(t,e),this.emitEvent("column:visibility",{key:t,visible:!!e}),this.refresh()}toggleColumnVisibility(t){let e=this.store.state.columnVisibility[t]===!1;return this.setColumnVisibility(t,e)}setThemeClasses(t){return this.options.themeClasses={...this.options.themeClasses,...t||{}},this.renderer.setOptions(this.options),this.renderer.mount(),this.bindEvents(),this.refresh().then(()=>this)}getState(){return{...this.store.getState(),expandedRowIds:[...this.expandedRowIds]}}setState(t){return this.store.setState(t),Array.isArray(t?.expandedRowIds)&&(this.expandedRowIds=new Set(t.expandedRowIds.map(e=>String(e)))),this.refresh()}getView(){return this.lastView}getRows(){return this.store.rows}on(t,e){return this.events.on(t,e)}use(t){return t(this),this}registerHook(t,e){return this.hooks[t]=e,this}destroy(){this.searchTimer&&(clearTimeout(this.searchTimer),this.searchTimer=null),this.lastAnimationFrame&&(cancelAnimationFrame(this.lastAnimationFrame),this.lastAnimationFrame=null),this.store.destroy(),this.root.innerHTML="",this.emitEvent("destroy",{})}getRowId(t,e){let s=t[this.options.rowIdKey];return String(s??`${e}`)}findRowById(t){return this.store.rows.find((e,s)=>this.getRowId(e,s)===t)}emitEvent(t,e){this.events.emit(t,e),this.options.events.debug&&typeof console<"u"&&console.debug(`[vanilla-tables] ${t}`,e)}persistState(){this.stateSync.save(this.getState())}applySyncedState(){let t=this.stateSync.load();this.store.setState(t),Array.isArray(t?.expandedRowIds)&&(this.expandedRowIds=new Set(t.expandedRowIds.map(e=>String(e))))}computeVirtualWindow(t){if(!this.options.virtualScroll.enabled||!this.renderer.refs.tableWrap)return{enabled:!1,start:0,end:t,rowHeight:this.options.virtualScroll.rowHeight};let e=this.renderer.refs.tableWrap,s=this.options.virtualScroll.rowHeight,r=this.options.virtualScroll.overscan,i=Math.ceil((e.clientHeight||this.options.virtualScroll.height)/s),o=Math.max(0,Math.floor(e.scrollTop/s)-r),n=Math.min(t,o+i+r*2);return{enabled:!0,start:o,end:n,rowHeight:s}}getTableId(){return this.root.id?this.root.id:`vt-${Math.random().toString(36).slice(2,10)}`}};function D(h){return h.length?Object.keys(h[0]).map(t=>({key:t,label:t.charAt(0).toUpperCase()+t.slice(1),editable:!0})):[]}function G(h={}){let t=h.className||"vt-row-striped";return e=>{e.registerHook("afterRowRender",({element:s})=>{Array.from(s.parentElement.children).indexOf(s)%2===1&&s.classList.add(t)})}}function x(h){return t=>{t.setThemeClasses(h||{})}}function J(){return x({shell:"border-0 rounded-0 bg-transparent",controls:"d-flex flex-wrap gap-2 align-items-center justify-content-between w-100",searchWrap:"d-inline-flex align-items-center gap-2",sizeWrap:"d-inline-flex align-items-center gap-2",searchInput:"form-control form-control-sm",sizeSelect:"form-select form-select-sm",tableWrap:"table-responsive",table:"table table-hover table-striped mb-0",sortTrigger:"btn btn-sm p-0 border-0 bg-transparent text-body fw-semibold",actionHeader:"text-body fw-semibold small",columnFilter:"form-control form-control-sm",actionSelect:"form-select form-select-sm w-auto",actionButton:"btn btn-outline-secondary btn-sm",footer:"d-flex justify-content-between align-items-center mt-2",paginationGroup:"d-inline-flex align-items-center gap-2 ms-auto",firstButton:"btn btn-outline-secondary btn-sm",prevButton:"btn btn-outline-secondary btn-sm",nextButton:"btn btn-outline-secondary btn-sm",lastButton:"btn btn-outline-secondary btn-sm",expandTrigger:"btn btn-outline-primary btn-sm",editableCell:"bg-light-subtle"})}function X(){return x({shell:"is-block",controls:"level is-mobile mb-3",searchWrap:"field has-addons",sizeWrap:"field has-addons",searchInput:"input is-small",sizeSelect:"select is-small",tableWrap:"table-container",table:"table is-fullwidth is-hoverable is-striped",sortTrigger:"button is-white is-small",columnFilter:"input is-small",footer:"level mt-3",paginationGroup:"buttons are-small",firstButton:"button is-light is-small",prevButton:"button is-light is-small",nextButton:"button is-light is-small",lastButton:"button is-light is-small",expandTrigger:"button is-info is-light is-small",editableCell:"has-background-light",actionButton:"button is-small is-primary is-light",actionSelect:"select is-small",actionHeader:"has-text-weight-semibold",fixedHeader:"has-background-white-ter",fixedFooter:"has-background-white-ter"})}function _(){return x({shell:"MuiBox-root",controls:"MuiToolbar-root MuiToolbar-gutters",searchWrap:"MuiFormControl-root",sizeWrap:"MuiFormControl-root",searchInput:"MuiInputBase-input MuiInputBase-sizeSmall",sizeSelect:"MuiNativeSelect-select MuiInputBase-input MuiInputBase-sizeSmall",tableWrap:"MuiTableContainer-root",table:"MuiTable-root",headerCell:"MuiTableCell-root MuiTableCell-head",bodyCell:"MuiTableCell-root",sortTrigger:"mui-sort-trigger",columnFilter:"MuiInputBase-input MuiInputBase-sizeSmall",footer:"MuiToolbar-root MuiToolbar-gutters",paginationGroup:"MuiPagination-root",firstButton:"MuiButtonBase-root MuiButton-root MuiButton-outlined MuiButton-sizeSmall",prevButton:"MuiButtonBase-root MuiButton-root MuiButton-outlined MuiButton-sizeSmall",nextButton:"MuiButtonBase-root MuiButton-root MuiButton-outlined MuiButton-sizeSmall",lastButton:"MuiButtonBase-root MuiButton-root MuiButton-outlined MuiButton-sizeSmall",expandTrigger:"MuiButtonBase-root MuiButton-root MuiButton-outlined MuiButton-sizeSmall",editableCell:"MuiTableCell-editable",actionButton:"MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-sizeSmall",actionSelect:"MuiNativeSelect-select MuiInputBase-input MuiInputBase-sizeSmall",actionHeader:"MuiTableCell-root MuiTableCell-head",fixedHeader:"MuiTable-stickyHeader",fixedFooter:"MuiTableFooter-root",fixedColumn:"MuiTableCell-sticky"})}function Q(){return x({shell:"block",controls:"flex flex-wrap items-center justify-between gap-3 border-b border-slate-200 p-3",searchWrap:"inline-flex items-center gap-2 text-sm text-slate-700",sizeWrap:"inline-flex items-center gap-2 text-sm text-slate-700",searchInput:"rounded-md border border-slate-300 px-2 py-1 text-sm",sizeSelect:"rounded-md border border-slate-300 px-2 py-1 text-sm",tableWrap:"overflow-x-auto",table:"min-w-full divide-y divide-slate-200",headerCell:"bg-slate-50 px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-600",bodyRow:"border-b border-slate-100",bodyCell:"px-3 py-2 text-sm text-slate-800",sortTrigger:"inline-flex items-center gap-1 text-xs font-semibold text-slate-700 hover:text-slate-900",columnFilter:"w-full rounded-md border border-slate-300 px-2 py-1 text-sm",filterRow:"bg-white",filterHeaderCell:"bg-white px-3 py-2",footer:"flex items-center justify-between gap-2 border-t border-slate-200 p-3",paginationGroup:"inline-flex items-center gap-2 ml-auto",firstButton:"rounded-md border border-slate-300 px-2 py-1 text-sm hover:bg-slate-50",prevButton:"rounded-md border border-slate-300 px-2 py-1 text-sm hover:bg-slate-50",nextButton:"rounded-md border border-slate-300 px-2 py-1 text-sm hover:bg-slate-50",lastButton:"rounded-md border border-slate-300 px-2 py-1 text-sm hover:bg-slate-50",info:"text-sm text-slate-600",expandTrigger:"rounded-md border border-slate-300 px-2 py-0.5 text-sm hover:bg-slate-50",editableCell:"bg-amber-50",actionsCell:"px-3 py-2",actionButton:"rounded-md border border-slate-300 px-2 py-1 text-xs hover:bg-slate-50",actionSelect:"rounded-md border border-slate-300 bg-white px-2 py-1 text-sm",actionHeader:"bg-slate-50 px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-600",emptyCell:"px-3 py-6 text-center text-sm text-slate-500",expandContent:"bg-slate-50 px-3 py-2 text-sm text-slate-700",fixedHeader:"sticky top-0 z-10",fixedFooter:"sticky bottom-0 z-10 bg-white",fixedColumn:"bg-white"})}function Y(h={}){return t=>{t.registerHook("afterRowRender",({element:e})=>{let s=e.querySelector(".vt-actions-cell");if(!s)return;let r=[...s.querySelectorAll(".vt-action-btn")];if(r.length<2)return;let i=document.createElement("select");i.className=t.renderer?.theme?.classOf?t.renderer.theme.classOf("actionSelect","vt-action-select"):"vt-action-select";let o=document.createElement("option");o.value="",o.textContent=h.placeholder||"Actions",i.appendChild(o),r.forEach(n=>{let a=document.createElement("option");a.value=n.dataset.actionId||"",a.textContent=n.textContent||n.dataset.actionId||"",i.appendChild(a)}),i.addEventListener("change",()=>{let n=i.value;if(!n)return;let a=e.dataset.rowId,l=t.findRowById(a),d=t.options.rowActions.find(p=>p.id===n);d&&l&&Promise.resolve(d.onClick?d.onClick({row:l,rowId:a,actionId:n,table:t,event:new Event("change")}):null).finally(()=>{t.emitEvent("row:action",{row:l,rowId:a,actionId:n}),t.refresh()}),i.value=""}),s.innerHTML="",s.appendChild(i)})}}function Z({endpoint:h,method:t="GET",headers:e={},mapResponse:s}){return r=>{let i=t.toUpperCase(),o=i==="GET",n=h,a={method:i,headers:{"Content-Type":"application/json",...e}};if(o){let l=new URLSearchParams({q:JSON.stringify(r)});n=`${h}${h.includes("?")?"&":"?"}${l.toString()}`}else a.body=JSON.stringify(r);return fetch(n,a).then(l=>l.json()).then(l=>s?s(l):l)}}function tt({endpoint:h,query:t,variablesKey:e="tableQuery",headers:s={},mapResponse:r}){return i=>fetch(h,{method:"POST",headers:{"Content-Type":"application/json",...s},body:JSON.stringify({query:t,variables:{[e]:i}})}).then(o=>o.json()).then(o=>r?r(o):o)}function et({fetchPage:h}){let t=null;return e=>(e.page<=1&&(t=null),Promise.resolve(h({cursor:t,pageSize:e.pageSize,searchTerm:e.searchTerm,columnFilters:e.columnFilters,sorts:e.sorts})).then(s=>(t=s.nextCursor||null,{rows:s.rows||[],totalRows:Number(s.totalRows||(s.rows||[]).length)})))}function gt(h,t,e){return new S(h,t,e).init()}return at(wt);})();
//# sourceMappingURL=vanilla-tables.min.js.map
